<!DOCTYPE html><html><title>RADAR</title>
<body style="margin:0;overflow:hidden;font:12px sans-serif;text-align:center">
<div style="position:relative;width:256px;height:256px;margin:auto;background:#C4A484;overflow:hidden" id=V>
 <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:9;color:red;font:bold 18px serif">+</div>
</div>
<div style="position:fixed;top:10px;right:calc(50% - 118px);width:75px;border-bottom:2px solid #000;text-align:right">50km</div>
<p id=M style="margin:5px">Ready</p>
<button onclick=c(-1)><</button><button onclick=g()>GPS</button><button onclick=m()>GO</button><button onclick=c(1) Gold>></button>
<br><input id=lt placeholder=Lat size=5><input id=ln placeholder=Lon size=5>
<script>
V=document.getElementById('V');M=document.getElementById('M');H=[];I=-1;
f=(y,x)=>{
 M.innerText='...';
 fetch('https://api.rainviewer.com/public/weather-maps.json').then(r=>r.json()).then(j=>{
  t=j.radar.past.at(-1).time; z=6; n=2**z; r=y*Math.PI/180;
  fX=(x+180)/360*n; fY=(1-Math.log(Math.tan(r)+1/Math.cos(r))/Math.PI)/2*n;
  iX=0|fX; iY=0|fY;
  oX=(.5-(fX-iX))*256; oY=(.5-(fY-iY))*256;
  H.push({
   u:`${j.host}/v2/radar/${t}/256/${z}/${iX}/${iY}/0/0_0.png`,
   s:new Date(t*1000).toLocaleTimeString(),
   t:`translate(calc(-50% + ${oX}px),calc(-50% + ${oY}px))`
  });
  I=H.length-1; d()
 }).catch(e=>M.innerText='!');
};
d=()=>{if(H[I]){V.innerHTML+=`<img src="${H[I].u}" style="position:absolute;top:50%;left:50%;transform:${H[I].t}">`;M.innerText=H[I].s}};
c=n=>{if(H[I+n]){I+=n;d()}};
m=()=>f(1*lt.value,1*ln.value);
g=()=>navigator.geolocation.getCurrentPosition(p=>{lt.value=p.coords.latitude.toFixed(3);ln.value=p.coords.longitude.toFixed(3);f(1*lt.value,1*ln.value)},e=>M.innerText='!',{timeout:9000});
</script></html>
