<title>R</title>
<body bgcolor=#fff style="margin:0;overflow:hidden;font-family:sans-serif">
<div id=C style="position:relative;width:256px;margin:20px auto">
  <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:9;pointer-events:none;font:40px serif;color:#000">+</div>
  
  <div id=V style="background:#C4A484;width:256px;height:256px;overflow:hidden"></div>
  
  <div style="position:absolute;bottom:10;right:10;width:75px;border-bottom:3px solid #000;font:10px sans-serif;text-align:right;background:rgba(255,255,255,0.6);padding:2px">50km</div>
</div>

<div style="text-align:center">
  <button onclick="n()" style="padding:8px 16px;cursor:pointer">SCAN</button>
  <p id="M" style="font-size:14px;color:#333">Ready</p>
</div>

<script>
Z=6;S=256;V=document.getElementById('V');M=document.getElementById('M');
n=()=>navigator.geolocation.getCurrentPosition(async p=>{
  M.innerText='Scanning...';
  y=p.coords.latitude;x=p.coords.longitude;
  v=2**Z;r=y*Math.PI/180;
  X=Math.floor((x+180)/360*v);
  Y=Math.floor((1-Math.log(Math.tan(r)+1/Math.cos(r))/Math.PI)/2*v);
  try{
    j=await(await fetch('https://api.rainviewer.com/public/weather-maps.json')).json();
    t=j.radar.past[j.radar.past.length-1].time;h=j.host;
    // Loading a single 256px tile
    V.innerHTML=`<img src="${h}/v2/radar/${t}/${S}/${Z}/${X}/${Y}/1/1_1.png" style="width:256px;height:256px;display:block">`;
    M.innerText=new Date(t*1000).toLocaleTimeString();
  }catch(e){M.innerText='Connection Error';}
},e=>M.innerText='GPS Error',{enableHighAccuracy:true});
</script>
