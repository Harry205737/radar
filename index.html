<!DOCTYPE html><html><title>LAVERTON RADAR</title>
<body style="margin:0;overflow:hidden;background:#1a1a1a;font:12px sans-serif;text-align:center;color:#fff">
<div style="position:relative;width:512px;height:512px;margin:auto;overflow:hidden;background:#222" id=V>
 <img src="bg.png" style="width:512px;height:512px;position:absolute;top:0;left:0;z-index:1">
 <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:9;color:red;font:24px serif;pointer-events:none;text-shadow:1px 1px #000">+</div>
</div>
<p id=M style="margin:10px">Initializing...</p>
<button onclick=c(-1)>&lt;</button>
<button id=P onclick="A=!A">PAUSE</button>
<button onclick=c(1)>&gt;</button>
<script>
V=document.getElementById('V');M=document.getElementById('M');H=[];I=-1;A=1;
// Laverton BOM Coordinates & Settings
LT=-37.855; LN=144.756; Z=8;

f=()=>{
 fetch('https://api.rainviewer.com/public/weather-maps.json').then(r=>r.json()).then(j=>{
  H=[];
  j.radar.past.forEach(fr=>{
   t=fr.time; n=2**Z; r=LT*Math.PI/180;
   fX=(LN+180)/360*n; fY=(1-Math.log(Math.tan(r)+1/Math.cos(r))/Math.PI)/2*n;
   iX=0|fX; iY=0|fY;
   oX=(0.5-(fX-iX))*256; oY=(0.5-(fY-iY))*256;
   H.push({
    u:`${j.host}${fr.path}/256/${Z}/${iX}/${iY}/1/1_1.png`,
    s:new Date(t*1000).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}),
    t:`translate(calc(-50% + ${oX}px),calc(-50% + ${oY}px))`
   });
  });
  I=H.length-1; d();
 }).catch(e=>M.innerText='Offline');
};

d=()=>{
 if(H[I]){
  e=document.getElementById('R'); if(e)e.remove();
  V.innerHTML+=`<img id=R src="${H[I].u}" style="position:absolute;top:50%;left:50%;transform:${H[I].t};z-index:2;mix-blend-mode:screen;width:256px;filter:brightness(1.5)">`;
  M.innerText='Laverton: '+H[I].s;
 }
};

c=n=>{I=(I+n+H.length)%H.length; d()};

// Animation Loop
setInterval(()=>{if(A)c(1)},800);

// Update data every 5 mins
setInterval(f,3e5);
f();
</script></html>
