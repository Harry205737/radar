<title>R-Lite</title><body bgcolor=#fff style=margin:0;overflow:hidden>
<div id=C style="position:relative;width:256px;margin:auto">
 <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:9;pointer-events:none;font:30px serif;color:red">+</div>
 <div id=V style="display:grid;grid-template-columns:repeat(2,128px);grid-template-rows:repeat(2,128px);background:#eee;width:256px;height:256px;overflow:hidden"></div>
 <div style="position:absolute;bottom:5;right:5;width:50px;border-bottom:2px solid #000;font:9px sans-serif;text-align:right">50km</div>
</div>
<div style=text-align:center>
 <button onclick=n()>SCAN</button><p id=M style="font-family:monospace;font-size:12px">...</p>
</div>
<script>
// Z=7 is the max free zoom; S=256 is the smallest supported size
Z=7;S=256;V=document.getElementById('V');M=document.getElementById('M');
n=()=>navigator.geolocation.getCurrentPosition(async p=>{
 M.innerText='requesting...';V.innerHTML='';
 y=p.coords.latitude;x=p.coords.longitude;
 v=2**Z;r=y*Math.PI/180;
 X=Math.floor((x+180)/360*v);
 Y=Math.floor((1-Math.log(Math.tan(r)+1/Math.cos(r))/Math.PI)/2*v);
 try{
  j=await(await fetch('https://api.rainviewer.com/public/weather-maps.json')).json();
  t=j.radar.past[j.radar.past.length-1].time;h=j.host;
  // We fetch 2x2 tiles (256px) but display them at 128px size to keep the UI small
  for(g=Y;g<=Y+1;g++)for(f=X;f<=X+1;f++){
   i=new Image();i.style.width='128px';i.style.height='128px';
   i.src=`${h}/v2/radar/${t}/${S}/${Z}/${f}/${g}/2/1_0.png`; // '2' is universal blue color
   V.appendChild(i);
  }
  M.innerText=new Date(t*1000).toLocaleTimeString();
 }catch(e){M.innerText='API Error'}
},e=>M.innerText='GPS Error');
</script>
