<title>RADAR</title><body style="margin:0;background:#000;color:#eee;overflow:hidden;font-family:sans-serif">
<div id=V style="display:grid;grid-template-columns:repeat(3,128px);width:384px;margin:auto"></div>
<div style="position:fixed;bottom:10;width:100%;text-align:center">
<button onclick=n()>GPS SCAN</button><p id=M>Standby</p></div><script>
// Z=Zoom (6 is best for regional rain), S=Tile size
Z=6;S=256;M=document.getElementById('M');V=document.getElementById('V');
n=()=>navigator.geolocation.getCurrentPosition(async p=>{
  M.innerText='Fetching Tiles...';V.innerHTML='';
  y=p.coords.latitude;x=p.coords.longitude;
  // Convert Lat/Lon to XY Tile Coords
  n=2**Z;r=y*Math.PI/180;
  X=Math.floor((x+180)/360*n);
  Y=Math.floor((1-Math.log(Math.tan(r)+1/Math.cos(r))/Math.PI)/2*n);
  // Get latest radar timestamp
  try{
    j=await(await fetch('https://api.rainviewer.com/public/weather-maps.json')).json();
    t=j.radar.past[j.radar.past.length-1].time;h=j.host;
    // Build 3x3 Grid
    for(g=Y-1;g<=Y+1;g++)for(f=X-1;f<=X+1;f++){
      img=new Image();img.style.width='128px';
      // Layering radar tile over a dark base
      img.src=`${h}/v2/radar/${t}/${S}/${Z}/${f}/${g}/1/1_1.png`;
      img.style.border='1px solid #222';
      V.appendChild(img);
    }
    M.innerText=`Radar: ${new Date(t*1000).toLocaleTimeString()} (Z:${Z})`;
  }catch(e){M.innerText='Offline/Err'}
},e=>M.innerText='GPS Error');
</script>
